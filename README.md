<h1 align="center">DV Helper</h1>

<p align="center">
  <img src="https://img.shields.io/badge/Licence-MIT-green.svg?style=for-the-badge&&logo=github" />
  <img src="https://img.shields.io/badge/Python-3.9%2B-blue.svg?style=for-the-badge&logo=python" />
  <img src="https://img.shields.io/badge/Windows-OS-red.svg?style=for-the-badge&logo=windows" />
</p>

## 项目介绍

**DV Helper** 是一款影片信息搜索和整理工具，能够自动从网站抓取影片信息、下载封面图片、生成标准的NFO文件，并按照演员分类整理影片文件。

### 主要功能
- 支持按影片编号搜索详细信息
- 批量处理文件夹中的视频文件
- 自动下载并裁剪封面图片
- 生成符合Kodi等媒体中心标准的NFO文件
- 按演员智能分类整理影片目录
- 支持登录功能以获取更多内容

## 项目结构

```
DV-Helper/
├── .gitignore              # Git忽略文件
├── README.md               # 项目说明文档
├── dvhelper.py             # 主程序文件
├── poetry.lock             # Poetry依赖锁定文件
└── pyproject.toml          # 项目配置和依赖声明
```

## 系统要求
- Python 3.9 或更高版本
- Windows 操作系统
- 已安装 Chrome 浏览器（用于登录功能）
- 网络连接（用于搜索和下载信息）

## 安装方法

### 方法一：使用 pip 安装（推荐）

1. 克隆或下载本项目到本地
2. 打开命令行，进入项目根目录
3. 执行以下命令以开发模式安装：

```bash
pip install -e .
```

此方法会在你的Python环境中安装项目及其依赖，并创建一个名为`dvhelper`的命令行工具，可在任何位置直接使用。

### 方法二：使用 Poetry 安装

如果你已安装 Poetry，可以使用以下命令安装：

```bash
poetry install
poetry run dvhelper --help
```

## 依赖项
项目依赖以下Python库：
- urllib3 (>=2.5.0,<3.0.0)
- beautifulsoup4 (>=4.13.4,<5.0.0)
- selenium (>=4.34.2,<5.0.0)
- pillow (>=11.3.0,<12.0.0)
- tqdm (>=4.67.1,<5.0.0)
- requests (>=2.32.4,<3.0.0)
- rich-argparse (>=1.7.1,<2.0.0)

安装过程中这些依赖会自动安装，无需手动操作。

## 使用方法

安装完成后，可以通过命令行使用 `dvhelper` 命令：

### 命令行参数
```
dvhelper [选项] 关键词或路径

选项:
  -h, --help            显示帮助信息并退出
  -v, --version         显示版本信息并退出
  -d DEPTH, --depth DEPTH
                        文件夹搜索深度（默认：0，表示仅搜索当前目录）
  -l, --login           忽略已保存的Cookie强制进行新的登录操作

参数:
  keywords_or_path      搜索关键词（如影片编号）或本地视频文件夹路径
                        可以使用逗号分隔多个关键词，或指定一个包含视频文件的文件夹路径进行批量处理
```

### 使用示例

#### 1. 搜索单个影片
```bash
dvhelper ABCDE-123
```
搜索编号为ABCDE-123的影片信息并在当前目录下生成整理好的影片目录。

#### 2. 搜索多个影片
```bash
dvhelper ABCDE-123,FGHIJ-456
```
使用逗号分隔多个搜索关键词，批量搜索多个影片。

#### 3. 批量处理文件夹中的视频
```bash
dvhelper D:\Movies -d 1
```
扫描D:\Movies目录及其一级子目录中的视频文件并生成整理好的影片目录。
使用`-d`参数可以指定子文件夹的扫描深度，`0`表示仅扫描当前目录。

#### 4. 强制重新登录
```bash
dvhelper ABCDE-123 -l
```
强制重新登录，忽略已保存的Cookie并进行新的登录操作。

## 工作原理

1. **初始化阶段**：程序启动后会检查是否存在有效的Cookies文件，如果不存在则使用匿名会话。
2. **输入处理**：解析用户提供的关键词或文件夹路径。
3. **信息抓取**：连接到指定网站搜索影片信息，包括标题、演员、发行日期等。
4. **资源下载**：下载影片封面图片并进行裁剪处理。
5. **文件生成**：创建标准的NFO文件，包含影片的完整元数据。
6. **文件整理**：按照演员名称分类创建目录，并将影片文件移动到相应目录。

## 目录结构说明

处理完成后，影片文件将按照以下结构组织：
```
#整理完成#/
├── 演员名称1/
│   └── [影片编号](发行年份)/
│       ├── 影片编号.mp4       # 影片文件
│       ├── 影片编号.nfo       # 影片元数据文件
│       ├── fanart.jpg         # 原始封面图片
│       └── poster.jpg         # 裁剪后的海报图片
├── 演员名称2/
│   └── [影片编号](发行年份)/
│       └── ...
└── ==多演员==/               # 多演员影片的存放目录
    └── ...
```

## 注意事项

1. **Cookie管理**：程序会在首次登录后保存Cookie到本地，以便后续使用。Cookie文件位于程序同级目录下的`cookies.json`。
2. **登录操作**：使用`-l`参数强制重新登录时，程序会打开Chrome浏览器，用户需要手动完成登录操作。
3. **影片命名**：为了提高识别率，请确保影片文件名包含正确的影片编号。
4. **支持的格式**：程序支持多种常见视频格式，包括但不限于MP4、MKV、AVI、WMV等。
5. **性能提示**：批量处理大量视频文件时，建议适当设置搜索深度，避免处理过多无关文件。

## 常见问题

### Q: 为什么有些影片无法找到？
A: 可能的原因包括：影片编号格式不正确、影片太新或太旧、网络连接问题等。请检查影片编号并重试。

### Q: 为什么需要登录？
A: 登录后可以访问更多影片信息，特别是一些需要权限的内容。

### Q: 如何更新程序？
A: 如果使用`pip install -e .`安装，可以直接拉取最新代码后运行该命令重新安装。

### Q: 支持哪些影片编号格式？
A: 支持常规格式（如ABCDE-123）、FC2格式（如FC2-123456）和特定厂商格式。

## 许可证
本项目采用 MIT 许可证 - 详情请查看 [LICENSE](LICENSE) 文件

## 免责声明
本工具仅用于个人学习和研究目的，用户应遵守相关法律法规，不得将其用于任何违法或侵犯他人权益的活动。

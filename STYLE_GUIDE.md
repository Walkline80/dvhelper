# DV-Helper 团队风格指南

本文档旨在为 DV-Helper 项目的开发者提供统一的编码和协作规范，确保代码质量和团队协作效率。

## 目录

- [1. Python 代码规范](#1-python-代码规范)
- [2. 命名约定](#2-命名约定)
- [3. 文档和注释](#3-文档和注释)
- [4. Git 提交信息规范](#4-git-提交信息规范)
- [5. 中英文混合文本格式](#5-中英文混合文本格式)
- [6. 测试规范](#6-测试规范)
- [7. 国际化规范](#7-国际化规范)

## 1. Python 代码规范

### 1.1 基本格式

- **编码**: 所有 Python 文件必须使用`UTF-8`编码
- **缩进**: 使用`Tab`进行缩进，不要使用`空格`
- **行长度**: 每行代码尽量不超过`88`个字符
- **空行**: 
	- 使用空行分隔不同的代码块
	- 空行不允许包含缩进
	- 模块级函数和类定义之间空`2`行
	- 类内部方法定义之间空`1`行

### 1.2 字符串

- **引号**: 字符串使用单引号包裹，字符串嵌套的情况下外层使用双引号

	```python
	# 推荐
	name = 'John'
	message = "He said 'hello'"
	```

### 1.3 导入

- **顺序**: 按以下顺序组织导入语句：

	1. 标准库导入
	2. 第三方库导入
	3. 本地模块导入

	```python
	# 可借助 isort 工具自动排序
	poetry run isort dvhelper.py 
	```

- **分组**: 不同类别的导入之间用空行分隔
- **模块属性设置**: 如果只需要单行设置某个模块的属性，则设置语句之间不需要空行，但需要与其它导入语句之间空一行

	```python
	# 推荐示例
	import logging

	import warnings
	warnings.filterwarnings("ignore", category=DeprecationWarning)

	import os
	import sys
	```

- **懒加载**: 对于大型或不常用的依赖，可以考虑使用函数内导入以减少启动时间

### 1.4 类型提示

- 为函数参数和返回值添加类型提示
- 使用`typing`模块提供的类型

## 2. 命名约定

### 2.1 变量和函数

- **变量名**: 使用小写字母和下划线（snake_case）

	```python
	user_name = 'Alice'
	```

- **函数名**: 使用小写字母和下划线（snake_case）

	```python
	def get_user_info():
	    pass
	```

### 2.2 类和常量

- **类名**: 使用驼峰命名法（CamelCase）

	```python
	class UserManager:
	    pass
	```

- **常量**: 使用全大写字母和下划线

	```python
	MAX_RETRY = 3
	```

### 2.3 私有成员

- 使用双下划线前缀标识类的私有方法或属性

	```python
	def __private_method(self):
	    pass
	```

## 3. 文档和注释

### 3.1 文档字符串

- 所有模块、类和函数都必须包含文档字符串
- 文档字符串使用三个双引号包围
- 函数文档字符串应包含：功能描述、参数说明、返回值说明和示例（如适用）

```python
def get_user_info(user_id: int) -> dict:
    """
    获取用户信息

    Args:
        user_id: 用户ID
        
    Returns:
        包含用户信息的字典
    """
    # 函数实现
```

### 3.2 内联注释

- 复杂的代码逻辑应有内联注释
- 注释应简洁明了，解释"为什么"而非"是什么"

## 4. Git 提交信息规范

### 4.1 提交信息格式

提交信息应遵循以下格式：

```docs
类型: 简短描述（50 个字符以内，包含中文时建议控制在 25~30 个汉字以内）

详细描述（可选，每行 72 个字符，包含中文时建议每行控制在 30~35 个汉字以内，
每段描述以`.`或`。`结尾，中文为主的描述使用中文标点符号。）

引用 Issue（可选，如 #123）
```

### 4.2 提交类型

- **feat**: 新功能
- **fix**: 修复 bug
- **docs**: 文档更新
- **style**: 代码风格调整（不影响功能）
- **refactor**: 代码重构
- **perf**: 性能优化
- **test**: 测试相关
- **build**: 构建系统或外部依赖变更（如依赖版本更新、构建脚本修改）
- **chore**: 构建过程或辅助工具变动（非build类型的其他维护工作）
- **i18n**: 国际化相关更新（翻译文本、语言支持等）

### 4.3 提交信息示例

```docs
fix: 修复登录功能中的 session 过期问题

当用户保持登录状态超过 24 小时后，系统未正确处理 session 过期情况，
导致用户操作时出现 500 错误。现在增加了过期检测和自动重新验证机制。

#456
```

## 5. 中英文混合文本格式

为了保持文档和代码注释的一致性和可读性，特制定以下中英文混合文本格式规则：

### 5.1 基本原则

- **可读性优先**: 优先考虑文本的可读性
- **一致性**: 在整个项目中保持一致的风格

### 5.2 英文单词和中文混合

- **普通英文单词**: 在中文句子中使用时，前后**添加**空格

	```docs
	修复了登录功能中的 session 过期问题
	```

- **技术术语、函数名、变量名、文件名**: 前后通常**不添加**空格

	```docs
	优化parse_movie_details函数性能
	更新dvhelper.py中的错误处理逻辑
	```

- **命令行工具名称**: 作为正式名称时**添加**空格，作为命令引用时**不添加**空格

	```docs
	使用 Git 命令初始化仓库
	执行git pull更新代码
	```

- **版本号、标识符**: 通常**不添加**前后空格

	```docs
	升级至v1.2.3版本
	修复ABC-123标识符解析错误
	```

### 5.3 特殊情况处理

- **长英文段落**: 如果是连续的英文段落，保持英文排版习惯，不要在每个单词后添加额外空格
- **表格内容**: 在表格中，根据内容长度和布局需求灵活调整空格使用

## 6. 测试规范

- 所有新功能必须编写对应的测试用例
- 保持测试用例的独立性，不依赖其他测试用例的执行结果
- 使用 pytest 框架编写测试
- 测试文件命名遵循`test_*.py`格式
- 测试类命名遵循`Test*`格式
- 测试方法命名遵循`test_*`格式

## 7. 国际化规范

- 所有用户可见的文本必须支持国际化，并以`中文`作为默认语言
- 使用 `gettext` 进行文本翻译
- 将所有需要翻译的字符串使用 `_()` 函数包裹

---

本风格指南将根据项目发展和团队反馈定期更新。如有建议或疑问，请提交 Issue 讨论。
